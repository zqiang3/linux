## 非阻塞I/O

system V的早期版本使用标志O_NDELAY指定非阻塞方式，在这些版本中，如果无数据可读，则read返回0。而系统又常将read的返回值解释为文件结束，两者有所混淆。

POSIX.1要求，对一个非阻塞的描述符如果无数据可读，read返回-1，并且errno被设置为EAGAIN。

O_NDELAY只是为了向后兼容，不应在新应用程序中使用。

## I/O多路转接

从一个描述符读，然后又写到另一个描述符时，可以通过循环的方式使用阻塞I/O

```
while ((n = read(STDIN_FILENO, buf, BUFSIZE)) > 0)
	if(wreite(STDOUT_FILENO, buf, n) != n)
		err_sys("write error");
```

如果要求**从两个描述符读数据**，若仍使用阻塞I/O，那么就有可能长时间阻塞在一个描述符上，另一个描述符虽然有很多数据却不能得到及时处理。

轮询方法：使用一个进程执行该程序，但使用非阻塞I/O读取数据，基本方法是将两个输入描述符都设置为非阻塞的，对第一个描述符发一个read，如果有数据，则读取并处理；如果无数，read立即返回。然后对第二个描述符作同样处理。在此之后，等待一段时间，再重复操作。

异步I/O：