为了方便管理，Linux文件系统为每个文件都分配两个数据结构，索引节点和目录项。它们主要用来记录文件的元信息和目录结构。

* 索引节点，简称为inode，用来记录文件的元数据，比如inode编号、文件大小、访问权限、修改日期、数据的位置等。索引节点和文件一一对应，它跟文件内容一样，都会被持久化存储到磁盘中。
* 目录项，简称为dentry，用来记录文件的名字、索引节点指针以及与其他目录项的关联关系。多个关联的目录项，就构成了文件系统的目录结构。不同于索引节点，目录项是由内核维护的一个内存数据结构，所以通常也叫做目录项缓存。

索引节点是每个文件的唯一标志，而目录项维护的是文件系统的树状结构。目录项和索引节点的关系是多对一，可以理解为一个文件有多个别名。

通过硬链接为文件创建的别名，就会对应不同的目录项，不过它们本质上还是链接同一个文件，它们的索引节点相同。

## 文件系统I/O

把文件系统挂载到挂载点后，就能通过挂载点，再去访问它管理的文件了。VFS提供了一组标准的文件访问接口，这些接口以系统调用的方式，提供给应用程序使用。

以cat命令为例，它首先调用open()，打开一个文件；然后调用read()，读取文件内容；最后再调用write()，把文件内容输出到控制台的标准输出中。

```c
int open(const char *pathname, int flags, mode_t mode);
ssize_t read(int fd, void *buf, size_t count);
ssize_t write(int fd, const void *buf, size_t count);
```

### I/O 的分类

1. 根据是否利用标准库缓存，把文件I/O分为缓冲I/O与非缓冲I/O。缓冲I/O是利用标准库缓存来加速文件的访问，标准库内部再通过系统调用访问文件。非缓冲I/O是直接通过系统调用来访问文件，不经过标准库。
2. 根据是否利用操作系统的页缓存，把文件I/O分为直接I/O与非直接I/O。直接I/O是指跳过操作系统的页缓存，直接跟文件系统交互来访问文件。非直接I/O在文件读写时，先要经过系统的页缓存，然后再由内核或额外的系统调用，真正写入磁盘。要实现直接I/O，需要在系统调用时，指定O_DIRECT标志。默认是使用非直接I/O。不论是直接I/O还是非直接I/O，本质上还是和文件系统交互，如果是在数据库等场景中，会跳过文件系统读写磁盘的情况，也就是我们通常所说的裸I/O。
3. 根据应用程序是否阻塞，把文件I/O分为阻塞I/O和非阻塞I/O。阻塞I/O是指应用程序在执行I/O操作后，如果没有得到响应，会阻塞当前线程，不能执行其他任务。非阻塞I/O，不会阻塞当前线程，可以继续执行其他任务，随后通过轮询或事件通知的形式，获取调用的结果。在访问管道或网络套接字时，设置O_NONBLOCK标志，就表示用非阻塞方式访问，默认是用阻塞访问。
4. 根据是否等待响应结果，可以把文件I/O分为同步和异步I/O。

